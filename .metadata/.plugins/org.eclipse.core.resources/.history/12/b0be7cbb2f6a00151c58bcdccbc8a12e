package svv.project;

import java.io.File;
import java.io.FileInputStream;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;

import org.jdom2.Document;
import org.jdom2.output.Format;
import org.jdom2.output.XMLOutputter;

import edu.illinois.ncsa.daffodil.japi.Compiler;
import edu.illinois.ncsa.daffodil.japi.Daffodil;
import edu.illinois.ncsa.daffodil.japi.DataProcessor;
import edu.illinois.ncsa.daffodil.japi.ParseResult;
import edu.illinois.ncsa.daffodil.japi.ProcessorFactory;

public class CsvParserExampleTest 
{
	public static void main(String args[]) throws Exception 
	{
		/**
		 * Create a Daffodil Compiler. Make sure it validates?
		 */
		Compiler c = Daffodil.compiler();
		c.setValidateDFDLSchemas(true);

		/**
		 * And then compile the schema. Why the original vs. the other XML? No
		 * idea...
		 * 
		 * But we get a ProcessorFactory from it.
		 */
		File schemaFiles = new File("/DFDLSchemas/csv.dfdl.xsd");
		ProcessorFactory pf = c.compileFile(schemaFiles);

		/**
		 * See if there was an error yet?
		 */
		/*
		if (pf.isError()) 
		{
			throw new Exception("error1");
		}
		*/

		/**
		 * Get a DataProcessor from the ProcessorFactory. I guess the parameter
		 * tells it where to start processing from? Why XPath here?
		 */
		DataProcessor p = pf.onPath("/");

		/**
		 * Again, check if there is an error with the DataProcessor?
		 */
		if (p.isError()) 
		{
			throw new Exception("error2");
		}

		/**
		 * Get a File for the test data.
		 */
		//File dataFile = new File("C:/Users/SaiManjula/Documents/TTU/Fall 2015/SVV/Project/Project Files/SimpleCSV.csv");
		File dataFile = new File("/TestFiles/SimpleCSV.csv");
		FileInputStream fis = new FileInputStream(dataFile);
		ReadableByteChannel rbc = Channels.newChannel(fis);

		/**
		 * Now finally try to parse the sample data.
		 */
		ParseResult actual = p.parse(rbc);

		/**
		 * And see if there is an error again?
		 */
		if (actual.isError()) 
		{
			throw new Exception("error3");
		}

		Document doc = actual.result();
		XMLOutputter xo = new XMLOutputter();
		xo.setFormat(Format.getPrettyFormat());
		xo.output(doc, System.out);
	}

}
